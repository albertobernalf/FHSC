SELECT * FROM HOSVITAL.BLTAINV WHERE BLTANO=2020 AND BLTMES=12 ; --Esta es la numeracion de las boletas 405,406,407,408,409,410.Aqui se crean las Boletas

select * from hosvital.bltainv2 WHERE BLTANO=2020 AND BLTMES=10 and bltnro in (405,406,407,408,409,410); 

SELECT * FROM HOSVITAL.BLTAINV2 WHERE BLTANO=2020 AND BLTMES=10 ORDER BY BLTNRO,BLTNROCNT,BLTCSC;


select * from hosvital.bltainv3 WHERE BLTANO=2020 AND BLTMES=10 and bltnro in (405,406,407,408,409,410); 
select * from hosvital.bltainv3 WHERE BLTANO=2020 AND BLTMES=10 and bltnro in (397,398,399,400,401,402,403,404); 


SELECT * FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=10  ORDER BY BLTNRO,BLTCSC;

select * from hosvital.kardex where msreso='0295J01D';  -- 1270.00	 /1373

select * from HOSVITAL.BLTAINV2 WHERE BLTANO=2020 AND BLTMES=10 and msreso= '0295J01D' ; --consecutivo 485 en esta tablaseguardan losconsecutivosdelos conteos
select * from hosvital.bltainv3 WHERE BLTANO=2020 AND BLTMES=10 and bltnro in (397,398,399,400,401,402,403,404) and bltcsc=485 and msreso='0295J01D';

update HOSVITAL.BLTAINV 
setCODUSU='', FECACTINV='2020-10-30 09:05:01.00000',ESTACTINV='S'
WHERE BLTANO=2020 AND BLTMES=10 and DOCCOD='IBI' AND BLTNRO=407;

-- Los ACTIVOS

SELECT * FROM HOSVITAL.BLTAINV WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417,418,419);

SELECT * FROM HOSVITAL.BLTAINV2 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417,418,419);


SELECT * FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417,418,419) ;


SELECT count(*) FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417,418,419)  and  ( bltcntno1 <> 0); -- 575
SELECT count(*) FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417,418,419)  and  ( bltcntno2 <> 0);  -- 1
SELECT count(*) FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417,418,419)  and  ( bltcntno3 <> 0); -- 0


SELECT * FROM HOSVITAL.BLTAINV2 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417,418,419)  order by bltestcnt;

SELECT count(*) FROM HOSVITAL.BLTAINV2 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (419) ; --2

SELECT count(*) FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (419) ; -- 157

SELECT count(*) FROM HOSVITAL.BLTAINV2 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (418) ; --203

SELECT count(*) FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (418) ; -- 1443

-- query Diciembre


select bltnro, bltnrocnt, bltestcnt,count(*)  FROM HOSVITAL.BLTAINV2 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417,418,419)  group by bltnro, bltnrocnt, bltestcnt order by bltnro,bltnrocnt ; --2

select * fromhosvital.movinv4 ;

-- query Octubre

select bltnro, bltnrocnt, bltestcnt,count(*)  FROM HOSVITAL.BLTAINV2 WHERE BLTANO=2020 AND BLTMES=10 and  bltnro in (405,406,407,408,409)    group by bltnro, bltnrocnt, bltestcnt order by bltnro,bltnrocnt ; --2

SELECT * FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (418) order by bltdifno12; -- creo tan solo hay 17
SELECT * FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417) order by bltdifno12; -- creo tan solo hay 95


SELECT count(*) FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (418) and bltdifno12 <> 0;  -- 16
SELECT count(*) FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417) and bltdifno12 <> 0; -- 89/50

SELECT * FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (418) AND MSRESO='0235ZZZ1';

--ara ver siexiste un producto

SELECT * FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in   (417,418,419)  AND MSRESO= '0360J04B' ;



SELECT * FROM HOSVITAL.BLTAINV3 WHERE MSRESO= '0235ZZZ1' ;

--  En la maesum1

SELECT * FROM HOSVITAL.MAESUM1 WHERE MSRESO = '0235ZZZ1';

-- Query verifica grabacion:

SELECT * FROM HOSVITAL.MOVINV4 WHERE FCHMVT>='2020-12-18 00:00:00'; --  AND DOCCOD <> 'ASA';

SELECT doccod, count(*) 
 FROM HOSVITAL.MOVINV4 
WHERE FCHMVT>='2020-12-18 05:58:33' and FCHMVT<='2020-12-18 23:59:59' and  mvtobde='01'
group by doccod;

SELECT *  FROM HOSVITAL.MOVINV4 WHERE FCHMVT>='2020-12-18 05:58:33' and FCHMVT<='2020-12-18 22:59:59' and  mvtobde='01' order by FCHMVT ;
SELECT COUNT(*)  FROM HOSVITAL.MOVINV4 WHERE FCHMVT>='2020-12-18 05:58:33' and FCHMVT<='2020-12-18 22:59:59'   AND  (MVTOBDE ='01' OR MVTOBDS = '01') ; --  order by FCHMVT ;
SELECT COUNT(*)  FROM HOSVITAL.MOVINV4 WHERE FCHMVT>='2020-12-18 05:58:33' and FCHMVT<='2020-12-18 22:59:59'   AND  (MVTOBDE ='81' OR MVTOBDS = '81') ; -- order by FCHMVT ;


/*
IAD	239	
AEN	6	

*/

SELECT doccod, count(*) 
 FROM HOSVITAL.MOVINV4 
WHERE FCHMVT>='2020-12-18 05:58:33' and FCHMVT<='2020-12-18 23:59:59' and  mvtobds='01'
group by doccod;

/*
IAD	185	

*/

SELECT *  
 FROM HOSVITAL.MOVINV4 
WHERE FCHMVT>='2020-12-18 05:58:33' and mvtobde='01' and doccod='AEN' ORDER BY DOCNRO;

SELECT *  
 FROM HOSVITAL.MOVINV4 
WHERE FCHMVT>='2020-12-18 05:58:33' and mvtobds='01'
;

select * from hosvital.docucon where doccod in ('IAD','AEN');

SELECT * FROM HOSVITAL.BLTAINV2 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417,418,419) order by msreso,bltnro;

SELECT * FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417,418,419) order by msreso,bltnro;
SELECT * FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417,418,419)  and  bltcntno1 <> bltcntno2;
SELECT * FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417,418,419)  and  bltcntno1  =  bltcntno2;

-- Inconsistencias

SELECT * FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417,418,419)  and  bltcntno1  =  bltcntno2 and bltcntno1 <> bltcntdef;

SELECT * FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417,418,419)  and  bltcntno1 <> bltcntno2 and  bltcntdef <>  (bltcntno2 - bltcntno1);


SELECT * FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417) AND MSRESO = '0439N01B';
SELECT * FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12 and  bltnro in (417) AND MSRESO = '0803V07A';


SELECT *  FROM HOSVITAL.MOVINV4 WHERE DOCCOD = 'IAD' AND DOCNRO>= 44867 ORDER BY DOCNRO ;

SELECT * FROM HOSVITAL.KARDEX1 WHERE DOCTIP  = 'IAD' AND DOCNRO>= 44867;

SELECT INV3.BLTNRO, INV3.MSRESO,INV3.BLTSLDUND,INV3.BLTCNTDEF,INV4.DOCNRO, INV4.MSRESO,INV4.MVTOES, INV4.MVTOCNT, INV4.MVTODOCRF
FROM HOSVITAL.BLTAINV3 INV3
INNER JOIN HOSVITAL.MOVINV4 INV4 ON (INV4.DOCCOD='IAD' AND INV4.MVTODOCRF= INV3.BLTNRO AND INV4.MSRESO= INV3.MSRESO)
WHERE INV3.DOCCOD='IBI' AND INV3.bltnro in (417,418,419) AND INV3.BLTCNTNO1 =  INV3.BLTCNTNO2 -- AND INV3.MSRESO = '0439N01B'
ORDER BY INV3.MSRESO ;


-- Query de diferencias


SELECT INV3.BLTNRO, INV3.MSRESO,INV3.BLTSLDUND,INV3.BLTCNTDEF,INV4.DOCNRO, INV4.MSRESO,INV4.MVTOES, INV4.MVTOCNT, INV4.MVTODOCRF,
CASE WHEN INV4.MVTOES ='S' THEN (  INV3.BLTSLDUND -   INV3.BLTCNTDEF)    WHEN INV4.MVTOES ='E'  THEN  (   INV3.BLTCNTDEF - INV3.BLTSLDUND  )  END AS DEBIO
FROM HOSVITAL.BLTAINV3 INV3
INNER JOIN HOSVITAL.MOVINV4 INV4 ON (INV4.DOCCOD='IAD' AND INV4.MVTODOCRF= INV3.BLTNRO AND INV4.MSRESO= INV3.MSRESO)
WHERE INV3.DOCCOD='IBI' AND INV3.bltnro in (417,418,419) AND INV3.BLTCNTNO1 =  INV3.BLTCNTNO2 -- AND INV3.MSRESO = '0439N01B'
ORDER BY INV3.MSRESO ;

-- Query las diferentes


SELECT INV3.BLTNRO, INV3.MSRESO,INV3.BLTSLDUND,INV3.BLTCNTDEF,INV4.DOCNRO, INV4.MSRESO,INV4.MVTOES, INV4.MVTOCNT, INV4.MVTODOCRF,
CASE WHEN INV4.MVTOES ='S' THEN (  INV3.BLTSLDUND -   INV3.BLTCNTDEF)    WHEN INV4.MVTOES ='E'  THEN  (   INV3.BLTCNTDEF - INV3.BLTSLDUND  )  END AS DEBIO
FROM HOSVITAL.BLTAINV3 INV3
INNER JOIN HOSVITAL.MOVINV4 INV4 ON (INV4.DOCCOD='IAD' AND INV4.MVTODOCRF= INV3.BLTNRO AND INV4.MSRESO= INV3.MSRESO)
WHERE INV3.DOCCOD='IBI' AND INV3.bltnro in (417,418,419) AND INV3.BLTCNTNO1 =  INV3.BLTCNTNO2  AND
CASE WHEN INV4.MVTOES ='S' THEN (  INV3.BLTSLDUND -   INV3.BLTCNTDEF)    WHEN INV4.MVTOES ='E'  THEN  (   INV3.BLTCNTDEF - INV3.BLTSLDUND  )  END <>   INV4.MVTOCNT
ORDER BY INV3.MSRESO ;


-- TOTAL IAD


SELECT *  FROM HOSVITAL.MOVINV4 WHERE DOCCOD = 'IAD' AND FCHMVT>='2020-12-18 05:58:33' and FCHMVT<='2020-12-18 23:59:59';


SELECT COUNT(*)  FROM HOSVITAL.MOVINV4 WHERE DOCCOD = 'IAD' AND FCHMVT>='2020-12-18 23:00:33' and FCHMVT<='2020-12-18 23:59:59'; --  Genero 424 Ajustes

--        


SELECT * FROM HOSVITAL.KARDEX1 WHERE BODEGA='01' AND MSRESO = '0471N02B' AND MOVFCH >= '2020-12-18 05:58:33' and MOVFCH<='2020-12-18 22:59:59';
SELECT * FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12  AND MSRESO = '0471N02B'  and  bltnro in (417) ;



SELECT * FROM HOSVITAL.KARDEX1 WHERE BODEGA='01' AND MSRESO = '0439N01B' AND MOVFCH >= '2020-01-18 05:58:33' and MOVFCH<='2020-12-18 22:59:59' ORDER BY DOCNRO;
SELECT * FROM HOSVITAL.BLTAINV3 WHERE BLTANO=2020 AND BLTMES=12  AND MSRESO = '0439N01B'  and  bltnro in (417) ;
SELECT * FROM HOSVITAL.MOVINV4 WHERE DOCCOD='IAD' AND DOCNRO = 44867;
SELECT * FROM HOSVITAL.MOVINV4 WHERE DOCCOD='IAD' AND MSRESO = '0439N01B'  AND FCHMVT >= '2020-12-18 05:58:33';