SELECT
 h1.HISCKEY, 
cap.MPNOMC, 
mae.MENOME, 
i.INTEST, 
h1.HISCFCON, 
i.iNTFCHRSL, 
i.INTOBSORD, 
med.MMNOMM, h1.fhccodcto, emp.menomb
FROM HOSVITAL.MAEESP mae
left  JOIN HOSVITAL.INTERCN i ON (i.mecode = mae.mecode)
left JOIN HOSVITAL.INTERCN1  i1 ON ( i1.histipdoc= i.histipdoc and i1.hisckey= i.hisckey and i1.hiscsec=i.hiscsec ) 
INNER JOIN HOSVITAL.CAPBAS cap ON (cap.mptdoc =  i1.HISTIPDOC  and cap.mpcedu = i1.hisckey) 
inner  JOIN HOSVITAL.HCCOM1 h1 ON (h1.HISTIPDOC  = i1.HISTIPDOC AND h1.hisckey= i1.hisckey and h1.hiscsec=i1.hiscsec and h1.HCTVIN1 = i.INTCTVIN  )
left  join hosvital.maeemp emp on (emp.mennit=h1.fhccodcto)
LEFT JOIN HOSVITAL.MAEMED1 med ON ( med.mmusuario = i.INTUSRRSP )
WHERE h1.HISCFK BETWEEN '2019-08-01' AND '2019-08-31' AND i1.MECODE in ('100', '290', '386', '730', '781', '610')   
order by  h1.HISCKEY, cap.MPNOMC ;  


---
--
-------
SELECT  --count(*)
 HOSVITAL.INTERCN.HISCKEY, 
HOSVITAL.CAPBAS.MPNOMC, 
HOSVITAL.MAEESP.MENOME, 
HOSVITAL.INTERCN.INTEST, 
HOSVITAL.HCCOM1.HISCFCON, 
HOSVITAL.INTERCN.INTFCHRSL, 
HOSVITAL.INTERCN.INTOBSORD, 
HOSVITAL.MAEMED1.MMNOMM

FROM (((HOSVITAL.MAEESP INNER JOIN (HOSVITAL.INTERCN1 RIGHT JOIN HOSVITAL.INTERCN ON (HOSVITAL.INTERCN1.MECODE = HOSVITAL.INTERCN.MECODE) AND (HOSVITAL.INTERCN1.HISCSEC = HOSVITAL.INTERCN.HISCSEC) AND (HOSVITAL.INTERCN1.HISCKEY = HOSVITAL.INTERCN.HISCKEY) AND (HOSVITAL.INTERCN1.HISTIPDOC = HOSVITAL.INTERCN.HISTIPDOC)) ON HOSVITAL.MAEESP.MECODE = HOSVITAL.INTERCN.MECODE) INNER JOIN HOSVITAL.CAPBAS ON (HOSVITAL.INTERCN.HISTIPDOC = HOSVITAL.CAPBAS.MPTDOC) AND (HOSVITAL.INTERCN.HISCKEY = HOSVITAL.CAPBAS.MPCEDU)) INNER JOIN HOSVITAL.HCCOM1 ON (HOSVITAL.HCCOM1.HCTVIN1 = HOSVITAL.INTERCN.INTCTVIN) AND (HOSVITAL.INTERCN.HISCSEC = HOSVITAL.HCCOM1.HISCSEC) AND (HOSVITAL.INTERCN.HISTIPDOC = HOSVITAL.HCCOM1.HISTIPDOC) AND (HOSVITAL.INTERCN.HISCKEY = HOSVITAL.HCCOM1.HISCKEY)) LEFT JOIN HOSVITAL.MAEMED1 ON HOSVITAL.INTERCN.INTUSRRSP = HOSVITAL.MAEMED1.MMUSUARIO 


WHERE HOSVITAL.HCCOM1.HISCFK BETWEEN '2019-08-01' AND '2019-08-31' AND HOSVITAL.INTERCN.MECODE in ('100', '290', '386', '730', '781', '610')  and HOSVITAL.INTERCN.HISCKEY= '10059706' 
 order by   HOSVITAL.INTERCN.HISCKEY, HOSVITAL.CAPBAS.MPNOMC ;  --832


select * from hosvital.intercn;
select * from hosvital.hccom1;

----------------
-------------------
-- Segundo query
-----------------------
-------------------------

SELECT HOSVITAL.MAEATE2.PRCODI AS COD_PROC, HOSVITAL.MAEPRO.PRNOMB AS DESCRIPCION, HOSVITAL.MAEATE2.MAFEPR AS FECHA_PROC, HOSVITAL.MAEATE2.MACANPR AS CANTIDAD, HOSVITAL.MAEATE2.MPINTE AS VL_UNIT, HOSVITAL.MAEATE2.MAVATP AS TOTAL_PROC, HOSVITAL.MAEPAB.MPNOMP AS PABELLON 
FROM HOSVITAL.MAEPAB 
INNER JOIN (HOSVITAL.MAEATE2 
INNER JOIN HOSVITAL.MAEPRO ON HOSVITAL.MAEATE2.PRCODI = HOSVITAL.MAEPRO.PRCODI) ON HOSVITAL.MAEPAB.MPCODP = HOSVITAL.MAEATE2.MACODPAB 
WHERE HOSVITAL.MAEATE2.FCPTPOTRN<>'H' AND HOSVITAL.MAEATE2.MAESANUP<>'S' AND DATE (HOSVITAL.MAEATE2.MAFEPR)>='2019-08-01' AND DATE(HOSVITAL.MAEATE2.MAFEPR)<='2019-08-31' AND HOSVITAL.MAEATE2.PRCODI IN ('FHSCTC', '890610', '893700', '893703', '893805', '893808', '893812', '893818', '896600', '903062', '903110', '903839', '931000', '933500', '933600', '933601', '937000', '937101', '937200', '938300', '938303', '939400', '939402', '939403', '99999903', '99999905', '99999906', '99999907', '931001') ;


-- Nuevo query


SELECT m2.PRCODI AS COD_PROC, maepro.prnomb AS DESCRIPCION, m2.MAFEPR AS FECHA_PROC, m2.MACANPR AS CANTIDAD, m2.MPINTE AS VL_UNIT, m2.MAVATP AS TOTAL_PROC, maepab.mpnomp AS PABELLON ,
cap.mptdoc as tipo_doc,cap.mpcedu as documento,cap.mpnomc as paciente
FROM HOSVITAL.MAEPAB  maepab
INNER JOIN HOSVITAL.MAEATE2 m2  ON (m2.macodpab =maepab.mpcodp)
inner join hosvital.maeate m on (m.mpnfac = m2.mpnfac)
inner join hosvital.capbas cap on (cap.mptdoc=m.mptdoc and cap.mpcedu=m.mpcedu)
INNER JOIN HOSVITAL.MAEPRO maepro ON (maepro.prcodi = m2.PRCODI)
WHERE m2.FCPTPOTRN<>'H' AND m2.MAESANUP<>'S' AND DATE (m2.MAFEPR)>='2019-08-01' AND DATE(m2.MAFEPR)<='2019-08-31' AND m2.PRCODI IN ('FHSCTC', '890610', '893700', '893703', '893805', '893808', '893812', '893818', '896600', '903062', '903110', '903839', '931000', '933500', '933600', '933601', '937000', '937101', '937200', '938300', '938303', '939400', '939402', '939403', '99999903', '99999905', '99999906', '99999907', '931001') ;

