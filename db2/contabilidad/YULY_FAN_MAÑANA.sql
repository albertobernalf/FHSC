select * from hosvital.hojobl  where empcod='03' and cntvig = 2019 order by cntcod; -- and cntcod like ('%2380%') ;
select * from hosvital.hojoblprv   where empcod='03' and cntvig = 2019   and cntcod like ('%2380%') ;
select * from hosvital.hojoblprv where empcod='03' and cntvig>=2019 and hopnoobl='NOTA 810';
select * from hosvital.hojoblprv where empcod='03' and cntvig>=2019 and hopnoobl='ADECCO ABRIL';

SELECT SUM(HOPVLROBL) FROM hosvital.hojoblprv   where empcod='03' and cntvig = 2019   and cntcod like ('%23809001%') AND PRVCOD='860007373' ;

SELECT SUM(HOPVLROBL) FROM hosvital.hojoblprv   where empcod='03' and cntvig = 2019   and cntcod like ('%23809001%') AND PRVCOD='860007373'  AND (HOPVLROBL+HOPTOTCRE-HOPTOTDEB) <> 0;  -- 1167187158.68

SELECT SUM(HOPVLROBL) FROM hosvital.hojoblprv   where empcod='03' and cntvig = 2019   and cntcod like ('%23809001%') AND PRVCOD='860007373'; -- 1206296768.68
SELECT SUM(HOPVLROBL) FROM hosvital.hojoblprv   where empcod='03' and cntvig = 2020   and cntcod like ('%23809001%') AND PRVCOD='860007373'; -- 523312527.00


SELECT *  FROM hosvital.hojoblprv   where empcod='03' and cntvig = 2020   and cntcod like ('%23809001%') AND PRVCOD='860007373' AND HOPVLROBL = 0 ; 
SELECT COUNT(*)  FROM hosvital.hojoblprv   where empcod='03' and cntvig = 2020   and cntcod like ('%23809001%') AND PRVCOD='860007373' AND HOPVLROBL = 0 ;  -- 91
SELECT COUNT(*)  FROM hosvital.hojoblprv   where empcod='03' and cntvig = 2020   and cntcod like ('%23809001%') AND PRVCOD='860007373' AND HOPVLROBL = 0  AND HOPTOTCRE=0 AND HOPTOTDEB=0; -- 90	



-- Veamso

select * from hosvital.hojoblprv where empcod='03' and cntvig>=2019 and hopnoobl='NOTA 810';
select * from hosvital.MOVCXP where empcod='03' and cntvig>=2019 and MVCXPNUOB ='NOTA 810';
select * from hosvital.MOVCXP where empcod='03' and cntvig>=2019 and MVCXPNUOB ='ADECCO ABRIL';
SELECT * FROM HOSVITAL.MOVCONT2 WHERE EMPCOD='03' AND CNTVIG=2019 AND MVCDOCRF1='NOTA 810';

select * from hosvital.hojoblprv where empcod='03' and cntvig>=2019 and hopnoobl='A124230';
select * from hosvital.MOVCXP where empcod='03' and cntvig>=2019 and MVCXPNUOB ='A124230';
select * from hosvital.MOVCXP where empcod='03' and cntvig>=2019 and MVCXPNUOB ='A124230';
SELECT * FROM HOSVITAL.MOVCONT2 WHERE EMPCOD='03' AND CNTVIG=2019 AND MVCDOCRF1='A124230';

-- MANOS A LA OBRA
DROP TABLE HOSVITAL.HOJOBLPRV_JULY_RESCATA;

CREATE TABLE HOSVITAL.HOJOBLPRV_JULY_RESCATA AS (SELECT *  FROM hosvital.hojoblprv   where empcod='03' and cntvig = 2020   and cntcod like ('%23809001%') AND PRVCOD='860007373' AND HOPVLROBL = 0  AND HOPTOTCRE=0 AND HOPTOTDEB=0) WITH DATA;
SELECT * FROM HOSVITAL.HOJOBLPRV_JULY_RESCATA ORDER BY HOPNOOBL;;
	
SELECT COUNT(*) FROM HOSVITAL.HOJOBLPRV_JULY_RESCATA;	 -- 90
SELECT SUM(HOPVLROBL) FROM hosvital.hojoblprv   where empcod='03' and cntvig = 2019   and cntcod like ('%23809001%') AND PRVCOD='860007373'  AND (HOPVLROBL+HOPTOTCRE-HOPTOTDEB) <> 0;  -- 1167187158.68	

SELECT CNTVIG,HOPNOOBL,PRVCOD,CNTCOD,HOPVLROBL,HOPTOTCRE,HOPTOTDEB FROM  HOSVITAL.HOJOBLPRV WHERE EMPCOD='03' AND PRVCOD='860007373' AND CNTCOD='23809001' AND HOPNOOBL= 'ABRIL';

UPDATE HOSVITAL.HOJOBLPRV P
SET P.HOPVLROBL = (SELECT P2.HOPVLROBL FROM HOSVITAL.HOJOBLPRV P2 WHERE P2.EMPCOD=P.EMPCOD AND P2.PRVCOD=P.PRVCOD AND P2.HOPNOOBL=P.HOPNOOBL AND P2.CNTVIG=2019 AND P2.CNTCOD=P.CNTCOD)
WHERE P.EMPCOD='03' AND P.PRVCOD='860007373' AND P.CNTVIG=2020 AND P.CNTCOD= '23809001' AND P.HOPNOOBL='ABRIL';

UPDATE HOSVITAL.HOJOBLPRV P
SET P.HOPVLROBL = 0,HOPTOTCRE=0 ,HOPTOTDEB=0
WHERE P.EMPCOD='03' AND P.PRVCOD='860007373' AND P.CNTVIG=2020 AND P.CNTCOD= '23809001' AND P.HOPNOOBL='ABRIL';


SELECT CNTVIG,HOPNOOBL,PRVCOD,CNTCOD,HOPVLROBL,HOPTOTCRE,HOPTOTDEB FROM  HOSVITAL.HOJOBLPRV_JULY_RESCATA WHERE EMPCOD='03' AND PRVCOD='860007373' AND CNTCOD='23809001' AND HOPNOOBL= 'ABRIL';
SELECT CNTVIG,HOPNOOBL,PRVCOD,CNTCOD,HOPVLROBL,HOPTOTCRE,HOPTOTDEB FROM  HOSVITAL.HOJOBLPRV WHERE EMPCOD='03' AND PRVCOD='860007373' AND CNTCOD='23809001' AND HOPNOOBL= '477';



UPDATE HOSVITAL.HOJOBLPRV_JULY_RESCATA P
SET (P.HOPVLROBL,HOPTOTCRE,HOPTOTDEB)  = (SELECT P2.HOPVLROBL,P2.HOPTOTCRE,P2.HOPTOTDEB FROM HOSVITAL.HOJOBLPRV P2 WHERE P2.EMPCOD=P.EMPCOD AND P2.PRVCOD=P.PRVCOD AND P2.HOPNOOBL=P.HOPNOOBL AND P2.CNTVIG=2019 AND P2.CNTCOD=P.CNTCOD)
WHERE P.EMPCOD='03' AND P.PRVCOD='860007373' AND P.CNTVIG=2020 AND P.CNTCOD= '23809001' AND P.HOPNOOBL='ABRIL';

-- UPDATE GENERAL A RESCATA 90 REGISTROS

UPDATE HOSVITAL.HOJOBLPRV_JULY_RESCATA P
SET (P.HOPVLROBL,HOPTOTCRE,HOPTOTDEB)  = (SELECT P2.HOPVLROBL,P2.HOPTOTCRE,P2.HOPTOTDEB FROM HOSVITAL.HOJOBLPRV P2 WHERE P2.EMPCOD=P.EMPCOD AND P2.PRVCOD=P.PRVCOD AND P2.HOPNOOBL=P.HOPNOOBL AND P2.CNTVIG=2019 AND P2.CNTCOD=P.CNTCOD)
WHERE P.EMPCOD='03' AND P.PRVCOD='860007373' AND P.CNTVIG=2020 AND P.CNTCOD= '23809001' ;


SELECT CNTVIG,HOPNOOBL,PRVCOD,CNTCOD,HOPVLROBL,HOPTOTCRE,HOPTOTDEB FROM  HOSVITAL.HOJOBLPRV_JULY_RESCATA WHERE EMPCOD='03' AND PRVCOD='860007373' AND CNTCOD='23809001';
select * from HOSVITAL.HOJOBLPRV_JULY_RESCATA;
------------------------------------------------------
--UPDATE MASIVO A PRODUCCION HOJOBLPRV
------------------------------------------------------

UPDATE HOSVITAL.HOJOBLPRV P
SET (P.HOPVLROBL,HOPTOTCRE,HOPTOTDEB)  = (SELECT P2.HOPVLROBL,P2.HOPTOTCRE,P2.HOPTOTDEB FROM HOSVITAL.HOJOBLPRV_JULY_RESCATA P2 WHERE P2.EMPCOD=P.EMPCOD AND P2.PRVCOD=P.PRVCOD AND P2.HOPNOOBL=P.HOPNOOBL AND P2.CNTVIG=2020 AND P2.CNTCOD=P.CNTCOD)
WHERE P.EMPCOD='03' AND P.PRVCOD='860007373' AND P.CNTVIG=2020 AND P.CNTCOD= '23809001'   AND P.HOPNOOBL IN (SELECT X.HOPNOOBL FROM HOSVITAL.HOJOBLPRV_JULY_RESCATA X) ;

SELECT CNTVIG,HOPNOOBL,PRVCOD,CNTCOD,HOPVLROBL,HOPTOTCRE,HOPTOTDEB FROM  HOSVITAL.HOJOBLPRV WHERE EMPCOD='03' AND PRVCOD='860007373' AND CNTCOD='23809001' AND HOPNOOBL= 'ABRIL';

-----------------------------
--------------------------------
-- OTRA VOZ JULY

SELECT * FROM HOSVITAL.HOJOBLPRV P WHERE EMPCOD='03' AND   P.PRVCOD='860007373' AND P.CNTVIG>=2019 AND P.CNTCOD= '23809001'  AND P.HOPNOOBL='A124678-1';

select cntvig, sum(HOPVLROBL), sum(HOPTOTCRE), sum(HOPTOTDEB)
from hosvital.hojoblprv
WHERE EMPCOD='03' AND PRVCOD='860007373' AND CNTVIG>=2019 AND CNTCOD= '23809001'  
group by cntvig;


select cntvig, sum(HOPVLROBL), sum(HOPTOTCRE), sum(HOPTOTDEB)
from hosvital.hojoblprv
WHERE EMPCOD='03' AND PRVCOD='860007373' AND CNTVIG>=2019 AND CNTCOD= '23809001'  AND (HOPVLROBL+HOPTOTCRE-HOPTOTDEB) <> 0
group by cntvig;

-- las canceladas
select * from HOSVITAL.HOJOBLPRV_JULY_RESCATA;
select *  FROM HOSVITAL.HOJOBLPRV_JULY_RESCATA P WHERE EMPCOD='03' AND   P.PRVCOD='860007373' AND P.CNTVIG=2020 AND P.CNTCOD= '23809001'  and hopvlrobl=hoptotdeb and hoptotdeb= hoptotcre;

select * from  HOSVITAL.HOJOBLPRV P WHERE EMPCOD='03' AND   P.PRVCOD='860007373' AND P.CNTVIG=2020 AND P.CNTCOD= '23809001'  and hopvlrobl=hoptotdeb and hoptotdeb= hoptotcre;

select * from  HOSVITAL.HOJOBLPRV P WHERE EMPCOD='03' AND   P.PRVCOD='860007373' AND P.CNTVIG>=2019 AND P.CNTCOD= '23809001' and hopnoobl ='ADECCO';


INSERT INTO HOSVITAL.HOJOBLPRV (EMPCOD,PRVCOD,HOPNOOBL,MCDPTO,CNTVIG,CNTCOD,CNUCOD,CNUSUB,CNCCOD,CNTSUB,HOPFCHOBL,HOPFCHRAD,HOPTPPZ,HOPVLRCUO,HOPCUOINI,HOPVLROBL,HOPVLRMEX,HOPTOTCRE,HOPTOTDEB,
HOPMVTER,HOJFCHCAN,HOPESTAFPT,HOJNROOC,HOJBASDES,HOJDOCOC,HOPSEDCAU,HOPDOCCAU,HOPNROCAU,HOPHOM)
SELECT EMPCOD,PRVCOD,HOPNOOBL,MCDPTO,2020,CNTCOD,CNUCOD,CNUSUB,CNCCOD,CNTSUB,HOPFCHOBL,HOPFCHRAD,HOPTPPZ,HOPVLRCUO,HOPCUOINI,HOPVLROBL,HOPVLRMEX,HOPTOTCRE,HOPTOTDEB,
HOPMVTER,HOJFCHCAN,HOPESTAFPT,HOJNROOC,HOJBASDES,HOJDOCOC,HOPSEDCAU,HOPDOCCAU,HOPNROCAU,HOPHOM
FROM HOSVITAL.HOJOBLPRV P WHERE EMPCOD='03' AND   P.PRVCOD='860007373' AND P.CNTVIG=2019 AND P.CNTCOD= '23809001' and hopnoobl ='ADECCO';
