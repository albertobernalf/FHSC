SELECT * FROM CIECAJa1   -- POR ESPECIE
where ccjcod=6597


SELECT * FROM CIECAJa -- TOTALES
where ccjcod=6597  -- 5705071.00

SELECT SUM(CIEVLR) FROM CIECAJA1  
where ccjcod=6597 --5705071.00





select * from entturn-- limit 100  -- RESUMEN TURNOS GRALES DE UN CIERRRE
where ccjcod=6588
ORDER BY TURCOD


SELECT SUM(TURVLRTOT)  from ENTTURN where ccjcod=5704  -- 15693844.00

select * from entturn1-- limit 100  --	 TOTALES x ESPECIE DE UN TURNO
where turcod= 53836


-- Donde vamos
SELECT * FROM CIECAJA WHERE CCJFCH>='2016-12-25'  --6598

SELECT C.TURCOD,C.CODPAGO,C.ENTVLRPAG
FROM CIECAJA A, ENTTURN B, ENTTURN1 C
WHERE A.ccjcod= B.ccjcod AND A.ccjcod=6598 AND
   B.TURCOD=C.TURCOD

   -- verifiacion cuadre

SELECT C.TURCOD,SUM(C.ENTVLRPAG), B.TURVLRTOT
FROM CIECAJA A, ENTTURN B, ENTTURN1 C
WHERE A.ccjcod= B.ccjcod AND A.ccjcod=6598 AND
   B.TURCOD=C.TURCOD
GROUP BY C.TURCOD,B.TURVLRTOT


----------------------------------------------------
----------------------------------------------------
----------------------------------------------------


-- Verifiacion cierre

SELECT D.CCJCOD AS CIERRE, C.TURCOD AS TURNO ,SUM(C.ENTVLRPAG) AS TURNO_ESPECIE, B.TURVLRTOT AS TOTAL_TURNO,D.CCJVLRTTL AS TOTAL_CIERRE
FROM CIECAJA A, ENTTURN B, ENTTURN1 C, CIECAJA D
WHERE A.ccjcod= B.ccjcod AND A.ccjcod=6597 AND
   B.TURCOD=C.TURCOD AND D.CCJCOD=B.CCJCOD
GROUP BY D.CCJCOD, C.TURCOD,B.TURVLRTOT,D.CCJVLRTTL -- $ 388000
ORDER  BY C.TURCOD

-- Cruce Caja - Turno

SELECT A.CCJCOD,A.CODPAGO,A.CODPAGO,A.CIEVLR as CIEVLR_del_Cierre,SUM(B.ENTVLRPAG) as ENTVLRPAG_del_turno
FROM CIECAJA1 A, ENTTURN1 B, ENTTURN C
WHERE A.CCJCOD= C.CCJCOD AND B.TURCOD=C.TURCOD AND A.CODPAGO=B.CODPAGO And
A.ccjcod=6591
GROUP BY A.CCJCOD,A.CODPAGO,A.CODPAGO,A.CIEVLR -- DIFERENCIA CIERRE EFECTIVO  $277000

VD	197900.00	197900.00
VE	248800.00	248800.00
VC	357400.00	357400.00
MD	572100.00	572100.00
EF	4328871.00	4605871.00


--Caso :

-- Turno Nro : 53829 
SELECT * FROM ENTTURN WHERE TURCOD =53829  -- CIERRE 6597 = 388000.00
SELECT * FROM ENTTURN1 WHERE TURCOD =53829  -- CIERRE 6597 = 388000.00
SELECT * FROM ABONOS WHERE TURCOD=53829 -- 388000 VALOR ABONOS TURNO


-- Turno Nro : 53816 
SELECT * FROM ENTTURN WHERE TURCOD =53816  -- CIERRE 6597  -- 871000.00
SELECT * FROM ENTTURN1 WHERE TURCOD =53816  -- CIERRE 6597 = 388000.00
SELECT SUM(ENTVLRPAG) FROM ENTTURN1 WHERE TURCOD =53816  -- CIERRE 6597 = 388000.00
SELECT * FROM ABONOS WHERE TURCOD=53816 -- 388000 VALOR ABONOS TURNO  -- 871000


--Sumatoria segun abonos del efectivo :

SELECT * FROM ABONOS1
WHERE ABONUM IN (SELECT ABONUM FROM ABONOS WHERE  TURCOD=53816)
ORDER BY  CODPAGO  -- Eefctivo  468000.00  -- OPS AQUI HAY UN ERROR




SELECT CODPAGO,SUM(ABOVALPGO) FROM ABONOS1
WHERE ABONUM IN (SELECT ABONUM FROM ABONOS WHERE  TURCOD=53816)
GROUP BY CODPAGO  -- Eefctivo  468000.00  -- OPS AQUI HAY UN ERROR

SELECT SUM(ABOVALPGO) FROM ABONOS1
WHERE ABONUM IN (SELECT ABONUM FROM ABONOS WHERE  TURCOD=53816)  -- 871000


SELECT SUM(ABOVLR) FROM ABONOS WHERE TURCOD=53816 -- 388000 VALOR ABONOS TURNO  -- 871000



-- Sumatria General de acuerdo a Abonos1

SELECT CODPAGO,SUM(ABOVALPGO) FROM ABONOS1
WHERE ABONUM IN (SELECT ABONUM FROM ABONOS WHERE  TURCOD IN (SELECT TURCOD FROM ENTTURN WHERE  ccjcod=6591))
GROUP BY CODPAGO  -- Eefctivo  Deberia dar : 5889920.00

SELECT *  FROM ABONOS1
WHERE ABONUM IN (SELECT ABONUM FROM ABONOS WHERE  TURCOD IN (SELECT TURCOD FROM ENTTURN WHERE  ccjcod=6591))
--GROUP BY CODPAGO  -- Eefctivo  Deberia dar : 5889920.00

SELECT * FROM ABONOS WHERE ABONUM IN ( 679587,679175,667675)

SELECT * FROM ABONOS
WHERE ABONUM  IN ( SELECT ABONUM FROM ABONOS1 WHERE CODPAGO='AE')

SELECT * FROM ABONOS1 WHERE CODPAGO='AE'
EF	5889920.00
MD	572100.00
VC	357400.00
VD	197900.00
VE	248800.00

-- vs  5040871.00


-- Hay problemas en el turno 53811

-- Turno Nro : 53811 
SELECT * FROM ENTTURN WHERE TURCOD =53811  -- CIERRE 6597  -- 871000.00
SELECT * FROM ENTTURN1 WHERE TURCOD =53811  -- CIERRE 6597 = 388000.00
SELECT * FROM ABONOS WHERE TURCOD=53811 -- 388000 VALOR ABONOS TURNO  -- 871000

SELECT CODPAGO,SUM(ABOVALPGO) FROM ABONOS1  -- DEBERIA HABER ESTO  : 41600.00
WHERE ABONUM IN (SELECT ABONUM FROM ABONOS WHERE  TURCOD=53811)
GROUP BY CODPAGO 

SELECT * FROM CIECAJA1 WHERE  ccjcod=6597
SELECT * FROM CIECAJA WHERE  ccjcod=6597

-- Actualiza los turnos en descuadre

BEGIN TRANSACTION;
UPDATE ENTTURN
SET TURVLRTOT= 41600
WHERE TURCOD =53811
-- COMMIT;


BEGIN TRANSACTION;
UPDATE ENTTURN1
SET ENTVLRPAG=41600
WHERE TURCOD =53811
-- COMMIT;
-- ROLLBACK

-- los totales del cierre :

BEGIN TRANSACTION;
UPDATE CIECAJA1
SET CIEVLR=5040871
WHERE    ccjcod=6597 AND CODPAGO='EF'
-- COMMIT;
-- ROLLBACK



BEGIN TRANSACTION;
UPDATE CIECAJA
SET CCJVLRTTL=6417071
WHERE    ccjcod=6597 
-- COMMIT;
-- ROLLBACK




BEGIN TRANSACTION;
UPDATE CIECAJA1
SET CIEVLR=4605871
WHERE    ccjcod=6597 AND CODPAGO='EF'
-- COMMIT;
-- ROLLBACK


-- Otra caso




6597	VD	VD	197900.00	197900.00
6597	VE	VE	248800.00	248800.00
6597	VC	VC	357400.00	357400.00
6597	MD	MD	572100.00	572100.00
6597	EF	EF	4605871.00	4616471.00

BEGIN TRANSACTION;
UPDATE CIECAJA1
SET CIEVLR=4616471
WHERE    ccjcod=6597 AND CODPAGO='EF'
-- COMMIT;
-- ROLLBACK

