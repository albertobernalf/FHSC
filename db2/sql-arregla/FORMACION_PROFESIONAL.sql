-- Actualizacion para estdiantes Ambulatorios

BEGIN TRANSACTION;
insert into alumnos1
select '1','001','',mecode,'2015-01-01','2015-06-30',0.00,'N','ME932'
from maeesp
WHERE  ESPEST = 'S'
--select * from maeesp where mecode =680
--  COMMIT
-- rollback


-- Busco el alumno

select alumcod,aLUNOMCMP,ALUMTIP,ALUMEST,* from alumnos WHERE ALUMCOD = '200920922'
select alumcod,aLUNOMCMP,ALUMTIP,ALUMEST,* from alumnos WHERE ALUMNOM1 LIKE ('%LAURA%') AND ALUMAPE1 LIKE ('%TORRES%')
 
select * from alumnos1 WHERE ALUMCOD = '201121349'

select count(*) from alumnos1 WHERE ALUMFCHFN >= '2016-10-30' -- aqui hay 25249 registros
---------------------------
create table alumnos1_20161011 as select  * from alumnos1


begin transaction;
update alumnos1
set alumfchfn='2016-10-31'
where alumfchfn='2016-09-30'
-- commit;

--21893
-- commit;
-- rollbacK

select alumcod,aLUNOMCMP,ALUMTIP,ALUMEST,* from alumnos WHERE ALUMCOD = '201121349'
select * from alumnos1 WHERE ALUMCOD = '201310174'

BEGIN TRANSACTION;
insert into alumnos1
	select '1','001','201611598',mecode,'2017-01-01','2017-01-31','ME932',0.00,'N'
	from maeesp
	WHERE ESPEST = 'S'

-- COMMIT
-- rollback

Begin transaction;
update alumnos1
set  alumfchfn='2017-01-31'
where  alumcod in ('201611598')
--  COMMIT




select * from alumnos1 WHERE ALUMCOD = '201020232'	-- 1094907548
-- COMMIT

select * from alumnos WHERE alumnodoc = '201020232'
select * from alumnos WHERE ALUMCOD = '201020232'	-- 1094907548

--  Rollback
--  commit			

select * from alumnos1 where alumfchfn='2016-07-31'

begin transaction;
update alumnos1
set  alumfchfn='2015-06-30'
where  alumcod in ('200821011','201011847','201013408','201012067','201012069','200920922',
--nop200720954
'201011650','201011728','201012773','200720584','201012430','201011185','200920092',
--no200913715
'201011221','200911330','200811997','200912906','200821122','200921206','200811788','200921886','200810135','200920206','200821522',
'200920040','200810901','200811555','200810204','200812288','200810677','200820892','200811025','200820863','200810132','200913782','200920720',
'200511520','200721143','200721139')

--  rollback
-- 	commit	






select * from alumnos1
where  alumcod in ('200811992','200821572','200810671','200810806','200912821','200821522','200710591','200820377',
'200711705','200520957','200720081','200810823','200913102','200710195','200620566','200820366','200810423','200710042',
'200711057','200811056','200820778','200810383','200812167','200811071','200810398','200720048','200811617','200616212',
'200720490','200910977','200710076','200711244','200920204','200720740','200810473','200710093','200911156','200912426',
'200821796')

order by alumfchfn




SELECT * FROM MAEMED1 WHERE MMCODM ='ME240'

select * from alumnos where alumnodoc = '200920092'  -- "200820377      "
select * from alumnos where alumnodoc = '1032427409'  -- ""201511008      "      "
select * from alumnos where alumnodoc = '1019026466'  -- ""201511225      "      "


select * from alumnos where ALUMCOD = '201011619' 

select * from alumnos1 where ALUMCOD = '201510095' 
select * from alumnos1 where ALUMCOD = '201521848'

-- 201010270
--201011619


Begin transaction;
update alumnos1
set  alumfchfn='2015-12-31'
where  alumcod ='200810522'	 -- alumfchfn = '2014-05-31'
--  rollback
-- 	commit		

201011728 / 1019064478
-- LAS ESPECIALIDADES QUER FALTAN

BEGIN TRANSACTION;
insert into alumnos1
select '1','001','200920092',mecode,'2015-01-01','2015-06-30',0.00,'N','ME932'
from maeesp
WHERE ESPEST = 'S' --AND MECODE NOT IN (SELECT ALUMESP FROM ALUMNOS1 WHERE ALUMCOD= '201011619')

-- COMMIT;



order by alumesp
select * from maeesp ORDER BY MECODE
where mecode = 783
select * from alumnos

SELECT * FROM ALUMNOS1 -- WHERE ALUMCOD IN ('9999999999','200410912')
WHERE alumfchfn>'2015-06-30' -- 77612




-- AMPLIACION DE VIGENCIAS FORMACION PROFESIONAL 


begin transaction;
update alumnos1
set alumfchfn='2015-09-30'
where alumfchfn = '2015-06-30'
-- commit;
-- 	commit	




BEGIN TRANSACTION;
delete from alumnos1 where alumcod = '200912513'
-- COMMIT

 
SELECT * FROM ALUMNOS1 WHERE alumcod= '200912513'

begin transaction;
update alumnos1
set  alumfchfn='2015-12-31'
where alumcod = '200620098'
--  	commit
-- rollback


-- Inserto al alumno las especialidades

200911330 ANDRÉS FELIPE BARRAGÁN AMADO 1098715238 


-- Ojo este es e kl query de actualzaicion

BEGIN TRANSACTION;
insert into alumnos1
select '1','001','200820892',mecode,'2015-01-01','2015-06-30',0.00,'N','ME932'
from maeesp
WHERE ESPEST = 'S'

-- COMMIT
-- rollback

SELECT * FROM ALUMNOS1 WHERE ALUMCOD= '201310487'

SELECT * FROM ALUMNOS1 ORDER BY ALUMFCHFN -- MAS O MENOS 150000 REGISTROS CON VIGENCIA A 2014-04-30

-- Par;a usuarios INACTIVOS




begin transaction;


begin transaction;
delete from  ALUMNOS1 WHERE alumcod= '201322859'
-- commit

insert into alumnos1
select '1','001','200820377',mecode,'2015-01-01','2012-12-31',0.00,'N','ME932'
from maeesp
WHERE ESPEST = 'S'
-- rollback
-- COMMIT

select '1','001','200620823',mecode,'2011-01-01','2012-12-31',0.00,'N','ME932'
from maeesp
WHERE ESPEST = 'S'

select * from alumnos1 --limit 100
where alumcod='200711235'

BEGIN TRANSACTION;
DELETE FROM alumnos1
WHERE alumcod='200711235'; -- CC: 80874893
-- ROLLBACK;
-- COMMIT;



begin transaction;
update alumnos1
set alumfchfn='2015-06-30'
where alumcod='201310487'

-- commit
-- rollback



select * from alumnos1 limit 10
select * from alumnos where alumest='A' -- 375
select * from alumnos where alumest='I' -- 229

SELECT * FROM ALUMNOS1
WHERE ALUMCOD IN (SELECT ALUMCOD FROM alumnos where alumest='A' ) AND
 ALUMFCHFN>= '2012-12-31'-- 72118 REGISTROS/71536
ORDER BY ALUMFCHFN


CREATE TABLE ALUMNOS1_20130218 AS SELECT * FROM ALUMNOS1
SELECT * FROM ALUMNOS1_20130218


BEGIN TRANSACTION;
UPDATE ALUMNOS1
SET ALUMFCHFN='2013-12-31'
WHERE ALUMCOD IN (SELECT ALUMCOD FROM alumnos where alumest='A' ) AND
 ALUMFCHFN>= '2012-12-31'-- 72118 REGISTROS/71536
-- ROLLBACK;
-- COMMIT


-- Veamos a ver cuales alumnos les hace faltan espoecialidades :
SELECT * FROM ALUMNOS1

SELECT A.ALUMCOD, COUNT(*)
FROM alumnos A,ALUMNOS1 B
WHERE A.ALUMEST='A' AND A.ALUMCOD= B.ALUMCOD
GROUP BY A.ALUMCOD
ORDER BY COUNT(*) DESC

SELECT * 
from maeesp
WHERE ESPEST = 'S'  -- 249

-- FILTROP

SELECT * FROM ALUMNOS1
SELECT * FROM MAEESP WHERE ESPEST = 'S'



-- Este es el filtrop
      

SELECT A.ALUMCOD,C.MECODE
FROM alumnos A
INNER JOIN ALUMNOS1 B ON ( B.ALUMCOD = A.ALUMCOD)
LEFT JOIN MAEESP C ON ( C.ESPEST = 'S'  )
WHERE A.ALUMEST='A' AND A.ALUMCOD='200913080' AND  C.MECODE NOT IN (SELECT X.ALUMESP FROM ALUMNOS1 X WHERE X.ALUMCOD=A.ALUMCOD)
GROUP BY A.ALUMCOD,C.MECODE
ORDER BY A.ALUMCOD,C.MECODE

-- QUERER QUE COMPLETA LOS QUE FALTAN

BEGIN TRANSACTION;
insert into alumnos1
select '1','001',A.ALUMCOD,C.MECODE,'2013-01-01','2013-12-31',0.00,'N','ME932'
FROM alumnos A
INNER JOIN ALUMNOS1 B ON ( B.ALUMCOD = A.ALUMCOD)
left JOIN MAEESP C ON ( C.MECODE!= b.ALUMESP and C.ESPEST = 'S'  )
WHERE A.ALUMEST='A'
GROUP BY A.ALUMCOD,C.MECODE
having c.mecode not in (select x.alumesp from alumnos1 x where x.alumcod = a.alumcod) -- conteo a 682000/700000

--ORDER BY A.ALUMCOD,C.MECODE
-- rollback
-- COMMIT

CREATE TABLE ALUMNOS1_20130620 AS SELECT * FROM ALUMNOS1 -- 97915
SELECT * FROM ALUMNOS1_20130620


SELECT * FROM ALUMNOS1 WHERE ALUMCOD= '1110460670' order by ALUMESP


select '1','001',A.ALUMCOD,C.MECODE,'2013-01-01','2013-12-31',0.00,'N','ME932'
FROM alumnos A
INNER JOIN ALUMNOS1 B ON ( B.ALUMCOD = A.ALUMCOD)
left JOIN MAEESP C ON ( C.MECODE!= b.ALUMESP and C.ESPEST = 'S'  )
WHERE A.ALUMEST='A' 
GROUP BY A.ALUMCOD,C.MECODE
having c.mecode not in (select x.alumesp from alumnos1 x where x.alumcod = a.alumcod)

SELECT * FROM ALUMNOS
-- Actualizacion masiva de la vigencia de uso del moduio de formacio profesiona


-- 1ER QUERY

BEGIN TRANSACTION;
UPDATE ALUMNOS1
SET ALUMFCHFN='2015-12-31'
--SELECT * FROM ALUMNOS1
WHERE ALUMCOD IN ('200821011','200821011','201011847','201013408','201012067','201012069','200920922','200720954','201011650','201011728',
'201012773','200720584','201012430','201011185','200920092','200913715','201011221','200811997','200821122','200811788','200810135',
'200920206','200821522','200810901','200811555','200810204','200812288','200810677','200820892','200820863','200920720','200511520',
'200721143','200721139','200811992','200821572','200810671','200810806','200912821','200821522','200711705')
-- COMMIT;	
-- ROLLBACK;

--SDO QUERY


BEGIN TRANSACTION;
UPDATE ALUMNOS1
SET ALUMFCHFN='2015-12-31'
--SELECT * FROM ALUMNOS1
WHERE ALUMCOD IN ('200720081','200913102','200820366','200811056','200820778','200812167','200810398','200910977','200710093','200912426',
'200821796','200721189','200912704','200921776','200820842','200820075','200820046','200811279','200710324','200910684','200912861',
'200820910','200810972','200810383','200820366','200811521','200920204','200811938','201511225','201511008','201410779','201410246','201511258',
'201522946','201411056','201423250','201324924','201510084','201324922','201410818','201411261','201310174','201310709','201511596','201511656',
'201213122','201521226','201521554','201511206','201510731','201314464','201522954','201210491','201410808','201517402','201410577','201510100',
'201511555')


-- COMMIT;
-- ROLLBACK;


'200720081',
'200913102',
'200820366',
'200811056',
'200820778',
'200812167',
'200810398',
'200910977',
'200710093',
'200912426',
'200821796',
'200721189',
'200912704',
'200921776',
'200820842',
'200820075',
'200820046',
'200811279',
'200710324',
'200910684',
'200912861',
'200820910',
'200810972',
'200810383',
'200820366',
'200811521',
'200920204',
'200811938',
'201511225',
'201511008',
'201410779',
'201410246',
'201511258',
'201522946',
'201411056',
'201423250',
'201324924',
'201510084',
'201324922',
'201410818',
'201411261',
'201310174',
'201310709',
'201511596',
'201511656',
'201213122',
'201521226',
'201521554',
'201511206',
'201510731',
'201314464',
'201522954',
'201210491',
'201410808',
'201517402',
'201410577',
'201510100',
'201511555')





BEGIN TRANSACTION;
UPDATE ALUMNOS1
SET ALUMFCHFN='2014-12-31'
--SELECT * FROM ALUMNOS1
WHERE ALUMCOD IN (SELECT ALUMCOD FROM ALUMNOS WHERE ALUMNODOC IN 
('1032417202','1020751854','1072658573','1019057237','80095363','1032436021','1020739205','1019051065','1072644270','1036131832','1020757345',
'1026569217','1070957630','1019047291','1019051935','1072653504','1015423943','1072655467','1075660004','53178167','1144031016','1130622644',
'1020742957','1038693517','1072655275','1019018541','1010194040','101362807','1047422885','107658597','1047410224','1001317464',
'1075539284','1052387072','1032418796','1019012351','1020762593','1020743647','1019044631','1020737811','1136882549','1018428921','1020749774',
'1020743549','1070008207','1032415724','1019028882','1018431277','1072650493','1020740481','1072656053','1015416623','1020747570','1020731993',
'1098627190','1014185558','1015414720','1019015819','1020756900','1020748432','1020734580','1032402230','1108929753','1020723489','1018431335',
'52718675','1090406119','56057917','42154504','1019019365','1020745785','1019013589','35427508','79723572','80092101','52999432','53178628',
'76332906','33368665','76332889','79880814','1032364637','1130610291','53123482','80449715','52992346','80758353','52517072','53911096',
'1072640751','53177855','52867343','79790726','52869493','1075222043','52998444','16077370','1071162279','1020723116','53178290','1026254247',
'1032443803','80196436','71264128','52807708','30237209','52717776','1032438553','1015418953','1019020269','1015407882','42130756','1110460670',
'1072638522','79918927')) -- 19055 REG 
-- COMMIT;
-- ROLBACK;


-- actualziacion al año 2015


select * from alumnos1
where alumfchfn = '2014-12-31'  -- 41834 registros



select * from alumnos1
where alumfchfn > '2014-12-31'  -- 753

select * from alumnos --limit 100
where alumest='A'  -- 918

select * from alumnos1
where alumfchfn > '2014-12-31' AND ALUMCOD IN (SELECT ALUMCOD FROM ALUMNOS where alumest='A' ) -- 501

select * from alumnos1
where alumfchfn = '2014-12-31' AND ALUMCOD IN (SELECT ALUMCOD FROM ALUMNOS where alumest='A' ) -- 41075


-- Primer UPDATE
CREATE TABLE ALUMNOS1_2014 AS SELECT * FROM ALUMNOS1;
SELECT * FROM  ALUMNOS1_2014
 
BEGIN TRANSACTION;
UPDATE ALUMNOS1
SET alumfchfn='2015-06-30'
where alumfchfn >= '2014-12-31' AND ALUMCOD IN (SELECT ALUMCOD FROM ALUMNOS where alumest='A' )
SELECT COUNT(*) FROM ALUMNOS1 where alumfchfn = '2015-06-30' AND ALUMCOD IN (SELECT ALUMCOD FROM ALUMNOS where alumest='A' )

-- COMMIT;
-- ROLLBACK;

-- Segundo UPDATE

BEGIN TRANSACTION;
UPDATE ALUMNOS1
SET alumfchfn='2015-06-30'
where alumfchfn > '2014-12-31' AND ALUMCOD IN (SELECT ALUMCOD FROM ALUMNOS where alumest='A' );

SELECT COUNT(*) FROM ALUMNOS1 where alumfchfn = '2014-12-31' AND ALUMCOD IN (SELECT ALUMCOD FROM ALUMNOS where alumest='A' )  -- 41075
SELECT COUNT(*) FROM ALUMNOS1 where alumfchfn >= '2014-12-31' AND ALUMCOD IN (SELECT ALUMCOD FROM ALUMNOS where alumest='A' ) -- 41576
-- COMMIT;
-- ROLLBACK;


SELECT * FROM ALUMNOS WHERE  alumest='A' 

SELECT * FROM ALUMNOS1 where alumfchfn = '2015-06-30' AND ALUMCOD IN (SELECT ALUMCOD FROM ALUMNOS where alumest='A' )

SELECT * FROM ALUMNOS WHERE ALUMCOD = '201410808'
SELECT * FROM ALUMNOS1 WHERE ALUMCOD = '200710093'

begin transaction;
update alumnos1
set  alumfchfn='2015-12-31'
where alumcod = '201510095'
--  	commit
-- rollback



BEGIN TRANSACTION;
insert into alumnos1
select '1','001','200910977',mecode,'2015-01-01','2015-12-31',0.00,'N','ME932'
from maeesp
WHERE ESPEST = 'S'

-- COMMIT
-- rollback
