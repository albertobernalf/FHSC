--caso proveedor 1020767968

select * from hosvital.hojoblprv where cntvig>=2019 and prvcod='1020767968' and hopfchobl ='2019-12-31 00:00:00' ;
select * from hosvital.movcxp where cntvig>=2019 and prvcod='1020767968'  and mvcxpfch ='2019-12-31 00:00:00' ;


select * from hosvital.hojoblprv where cntvig>=2019 and prvcod='19465673' and hopfchobl ='2019-12-31 00:00:00' ;
select * from hosvital.movcxp where cntvig>=2019 and prvcod = '19465673';
/*
1020665.00	
98664.00	
471250.00	
253750.00	

*/

select EMPCOD,PRVCOD,HOPNOOBL,MCDPTO,cntvig,CNTCOD,CNUCOD,CNUSUB,CNCCOD,CNTSUB,HOPFCHOBL,HOPFCHRAD,HOPTPPZ,HOPVLRCUO,HOPCUOINI,HOPVLROBL,HOPVLRMEX,HOPTOTCRE,HOPTOTDEB,
HOPMVTER,HOJFCHCAN,HOPESTAFPT,HOJNROOC,HOJBASDES,HOJDOCOC,HOPSEDCAU,HOPDOCCAU,HOPNROCAU,HOPHOM,HOJSEDOC
from hosvital.hojoblprv
where  cntvig=2019 and prvcod='384405' and hopfchobl ='2019-12-31 00:00:00' ;

-- Masivo


select EMPCOD,PRVCOD,HOPNOOBL,MCDPTO,cntvig,CNTCOD,CNUCOD,CNUSUB,CNCCOD,CNTSUB,HOPFCHOBL,HOPFCHRAD,HOPTPPZ,HOPVLRCUO,HOPCUOINI,HOPVLROBL,HOPVLRMEX,HOPTOTCRE,HOPTOTDEB,
HOPMVTER,HOJFCHCAN,HOPESTAFPT,HOJNROOC,HOJBASDES,HOJDOCOC,HOPSEDCAU,HOPDOCCAU,HOPNROCAU,HOPHOM,HOJSEDOC
from hosvital.hojoblprv
where  cntvig=2019  and hopfchobl ='2019-12-31 00:00:00'  -- and hopnoobl='INT.CES2019'
 and prvcod in ('1000696461','1000986374','1001277621','1004877145','1005713051','1005848468','1010184814','1010189512','1010197249','1010213410','1010219368','1010233114','1012340792','1012381944','1012417240','1012423289',
'1012426581','1012433582','1012449174','1013588722','1013591841','1013608193','1013608769','1013618958','1013620050','1013624323','1013640833','1013641192','1013654477','1013665145','1013686348','1014193194','1014202883',
'1014209733','1014235768','1015444067','1016023960','1018416848','1018418658','1018422897','1018429849','1018430548','1018431879','1018443461','1018444914','1018454454','1019093647','1019111679','1020718669','1022355191',
'1022368026','1022375632','1022376165','1022924125','1022939848','1022963931','1022967457','1023005189','1023009675','1023867277','1023870628','1023873578','1023874997','1023877715','1023884713','1023889547','1023890918',
'1023893373','1023899334','1023904079','1023905069','1023913608','1023919962','1023925228','1023926488','1023929711','1023936536','1023944138','1023948975','1023968249','1024482385','1024483030','1024485036','1024500875','1024504174',
'1024519190','1024526306','1024531987','1024543648','1024578542','1026557100','10298172','1030545169','1030575715','1030582725','1030587180','1030599413','1030612307','1030617808','1030626760','1030638500','1030658972',
'1030692619','1031122371','1031122621','1031156957','1032381194','1032385521','1032399352','1032424099','1032457212','1032457749','1033374711','1033678227','1033681711','1033686660','1033709358','1033712833','1033718881','1033741710',
'1033758503','1042424162','1043009931','1049412735','1050200436','1052399270','1052956816','1053339754','1053340987','1053799588','1053834193','1054991260','1056613110','1061714092','1065573140','1067940955','1070593319','1070962956',
'1071549586','1072195262','1073511774','1073685273','1075253346','1077425114','1077444182','1079033625','1081404479','1083454357','1084224893','1084254908','1090463417','10933046','1094879767','1098733102','1102814663','1110060101','1110509900',
'1111195369','1122135714','11252672','1129516497','11302835','1143132817','1143234026','1144127440','1214463047','17357683','19363483','19379501','19419251','19437281','19465673','20330196','20476735','22585312','23011386','23795562',
'25274850','27178434','27984240','28124651','30322458','3032652','3100453','31331335','3172096','3215784','32613727','32779024','32836224','32846883','33379620','35322645','35375916','35500597','35601231','35898737','36733602','37506238','38211410',
'38361593','38600773','39531958','39578953','39618907','39640379','39655909','39748194','39794610','39795320','39796844','39812844','41622977','41744952','43754751','43871908','45560047','51643566','51655583','51730947','51736936','51742012',
'51759151','51777802','51778838','51808767','51822660','51827661','51839321','51840563','51857023','51894941','51898857','51902806','51921884','51988529','51995943','51998162','52011078','52023683','52030890','52037488','52046048','52060255',
'52061917','52099568','52109821','52118601','52120320','52131115','52156630','52192772','52194624','52207929','52210000','52229626','52231530','52260166','52277895','52285137','52293515','52296166','52303413','52379732','52392282','52427522',
'52436813','52440239','52469665','52480969','52492656','52503938','52504304','52520481','52521883','52522879','52530528','52588414','52726141','52733444','52734866','52736327','52744445','52750422','52751948','52800279','52809993',
'52825313','52826563','52831447','52833159','52834850','52837686','52840369','52853377','52857709','52857755','52870101','52870568','52878581','52879373','52884663','52888116','52897772','52898880','52950771','52951065','52952018','52953035',
'52967068','52970716','52974552','53042278','53043435','53062666','53063741','53091198','53117684','53122128','53122693','53129153','53129750','53129844','53153805','53161656','53891071','588744','60397789','65555752','65831870',
'72261298','75074637','77006091','79220919','79289578','79313047','79334585','79385210','79424600','79492545','79497612','79505200','79562532','79604885','79616611','79653523','79705306','79742724','79770376','79910631','79973371','80037144',
'80048756','80052402','80122604','80123498','80127609','80137931','80163661','80227510','80245055','80245718','80251161','80352565','80352843','80370137','80751295','80760858','80777311','80825602','80832596','80879064','80881813','80895911',
'81735131','83183158','84451436','8721847','8735837','91515615','94064068')
order by prvcod;


insert into hosvital.hojoblprv (
EMPCOD,PRVCOD,HOPNOOBL,MCDPTO,CNTVIG,CNTCOD,CNUCOD,CNUSUB,CNCCOD,CNTSUB,HOPFCHOBL,HOPFCHRAD,HOPTPPZ,HOPVLRCUO,HOPCUOINI,HOPVLROBL,HOPVLRMEX,HOPTOTCRE,HOPTOTDEB,
HOPMVTER,HOJFCHCAN,HOPESTAFPT,HOJNROOC,HOJBASDES,HOJDOCOC,HOPSEDCAU,HOPDOCCAU,HOPNROCAU,HOPHOM,HOJSEDOC)
select EMPCOD,PRVCOD,HOPNOOBL,MCDPTO,2020,CNTCOD,CNUCOD,CNUSUB,CNCCOD,CNTSUB,HOPFCHOBL,HOPFCHRAD,HOPTPPZ,HOPVLRCUO,HOPCUOINI,HOPVLROBL,HOPVLRMEX,HOPTOTCRE,HOPTOTDEB,
HOPMVTER,HOJFCHCAN,HOPESTAFPT,HOJNROOC,HOJBASDES,HOJDOCOC,HOPSEDCAU,HOPDOCCAU,HOPNROCAU,HOPHOM,HOJSEDOC
from hosvital.hojoblprv
where  cntvig=2019 and  hopnoobl in ('CES.2019','INT.CES2019','VAC2019') and


prvcod  in ('1000696461','1000986374','1001277621','1004877145','1005713051','1005848468','1010184814','1010189512','1010197249','1010213410','1010219368','1010233114','1012340792','1012381944','1012417240','1012423289',
'1012426581','1012433582','1012449174','1013588722','1013591841','1013608193','1013608769','1013618958','1013620050','1013624323','1013640833','1013641192','1013654477','1013665145','1013686348','1014193194','1014202883',
'1014209733','1014235768','1015444067','1016023960','1018416848','1018418658','1018422897','1018429849','1018430548','1018431879','1018443461','1018444914','1018454454','1019093647','1019111679','1020718669','1022355191',
'1022368026','1022375632','1022376165','1022924125','1022939848','1022963931','1022967457','1023005189','1023009675','1023867277','1023870628','1023873578','1023874997','1023877715','1023884713','1023889547','1023890918',
'1023893373','1023899334','1023904079','1023905069','1023913608','1023919962','1023925228','1023926488','1023929711','1023936536','1023944138','1023948975','1023968249','1024482385','1024483030','1024485036','1024500875','1024504174',
'1024519190','1024526306','1024531987','1024543648','1024578542','1026557100','10298172','1030545169','1030575715','1030582725','1030587180','1030599413','1030612307','1030617808','1030626760','1030638500','1030658972',
'1030692619','1031122371','1031122621','1031156957','1032381194','1032385521','1032399352','1032424099','1032457212','1032457749','1033374711','1033678227','1033681711','1033686660','1033709358','1033712833','1033718881','1033741710',
'1033758503','1042424162','1043009931','1049412735','1050200436','1052399270','1052956816','1053339754','1053340987','1053799588','1053834193','1054991260','1056613110','1061714092','1065573140','1067940955','1070593319','1070962956',
'1071549586','1072195262','1073511774','1073685273','1075253346','1077425114','1077444182','1079033625','1081404479','1083454357','1084224893','1084254908','1090463417','10933046','1094879767','1098733102','1102814663','1110060101','1110509900',
'1111195369','1122135714','11252672','1129516497','11302835','1143132817','1143234026','1144127440','1214463047','17357683','19363483','19379501','19419251','19437281','19465673','20330196','20476735','22585312','23011386','23795562',
'25274850','27178434','27984240','28124651','30322458','3032652','3100453','31331335','3172096','3215784','32613727','32779024','32836224','32846883','33379620','35322645','35375916','35500597','35601231','35898737','36733602','37506238','38211410',
'38361593','38600773','39531958','39578953','39618907','39640379','39655909','39748194','39794610','39795320','39796844','39812844','41622977','41744952','43754751','43871908','45560047','51643566','51655583','51730947','51736936','51742012',
'51759151','51777802','51778838','51808767','51822660','51827661','51839321','51840563','51857023','51894941','51898857','51902806','51921884','51988529','51995943','51998162','52011078','52023683','52030890','52037488','52046048','52060255',
'52061917','52099568','52109821','52118601','52120320','52131115','52156630','52192772','52194624','52207929','52210000','52229626','52231530','52260166','52277895','52285137','52293515','52296166','52303413','52379732','52392282','52427522',
'52436813','52440239','52469665','52480969','52492656','52503938','52504304','52520481','52521883','52522879','52530528','52588414','52726141','52733444','52734866','52736327','52744445','52750422','52751948','52800279','52809993',
'52825313','52826563','52831447','52833159','52834850','52837686','52840369','52853377','52857709','52857755','52870101','52870568','52878581','52879373','52884663','52888116','52897772','52898880','52950771','52951065','52952018','52953035',
'52967068','52970716','52974552','53042278','53043435','53062666','53063741','53091198','53117684','53122128','53122693','53129153','53129750','53129844','53153805','53161656','53891071','588744','60397789','65555752','65831870',
'72261298','75074637','77006091','79220919','79289578','79313047','79334585','79385210','79424600','79492545','79497612','79505200','79562532','79604885','79616611','79653523','79705306','79742724','79770376','79910631','79973371','80037144',
'80048756','80052402','80122604','80123498','80127609','80137931','80163661','80227510','80245055','80245718','80251161','80352565','80352843','80370137','80751295','80760858','80777311','80825602','80832596','80879064','80881813','80895911',
'81735131','83183158','84451436','8721847','8735837','91515615','94064068') and hopfchobl ='2019-12-31 00:00:00' and (prvcod,hopnoobl) not in (select    prvcod,hopnoobl from hosvital.hojoblprv p1 where  p1.prvcod= prvcod and p1.hopnoobl = hopnoobl and p1.cntvig=2020) ;



--UltimoArchivo subido


insert into hosvital.hojoblprv (
EMPCOD,PRVCOD,HOPNOOBL,MCDPTO,CNTVIG,CNTCOD,CNUCOD,CNUSUB,CNCCOD,CNTSUB,HOPFCHOBL,HOPFCHRAD,HOPTPPZ,HOPVLRCUO,HOPCUOINI,HOPVLROBL,HOPVLRMEX,HOPTOTCRE,HOPTOTDEB,
HOPMVTER,HOJFCHCAN,HOPESTAFPT,HOJNROOC,HOJBASDES,HOJDOCOC,HOPSEDCAU,HOPDOCCAU,HOPNROCAU,HOPHOM,HOJSEDOC)
select EMPCOD,PRVCOD,HOPNOOBL,MCDPTO,2020,CNTCOD,CNUCOD,CNUSUB,CNCCOD,CNTSUB,HOPFCHOBL,HOPFCHRAD,HOPTPPZ,HOPVLRCUO,HOPCUOINI,HOPVLROBL,HOPVLRMEX,HOPTOTCRE,HOPTOTDEB,
HOPMVTER,HOJFCHCAN,HOPESTAFPT,HOJNROOC,HOJBASDES,HOJDOCOC,HOPSEDCAU,HOPDOCCAU,HOPNROCAU,HOPHOM,HOJSEDOC
from hosvital.hojoblprv
where  cntvig=2019 and  hopnoobl in ('CES.2019','INT.CES2019','VAC2019') and 
prvcod  in ('384405','1073692754','52307082','51693707','1010198004','1033724934','1030671561','1023879993','1030640604','80798392','1032378029','1065875334','52774833','1010199048','1070587757','1077424814',
'1136887130','1033724794','1013584946','1018421333','1110493409','52747538','52770836','80028381','1019088608','1032391946','1014229336','1049617946','1106397456','1018465750','1022377327',
'1016030625','1010215993','1067921150','1110494658','1045721387','52479459','19473199','53007499','1030580311','1015435254','1010176229','1057185438','70750806',
'1014228597','1031154728','79524588') and hopfchobl ='2019-12-31 00:00:00'  and  (hoptotcre - hoptotdeb) > 0 and (prvcod,hopnoobl) not in (select    prvcod,hopnoobl from hosvital.hojoblprv p1 where  p1.prvcod= prvcod and p1.hopnoobl = hopnoobl and p1.cntvig=2020) ;


select *  from hosvital.hojoblprv
where  cntvig=2020 and  hopnoobl in ('CES.2019','INT.CES2019','VAC2019') and
prvcod  in ('384405','1073692754','52307082','51693707','1010198004','1033724934','1030671561','1023879993','1030640604','80798392','1032378029','1065875334','52774833','1010199048','1070587757','1077424814',
'1136887130','1033724794','1013584946','1018421333','1110493409','52747538','52770836','80028381','1019088608','1032391946','1014229336','1049617946','1106397456','1018465750','1022377327',
'1016030625','1010215993','1067921150','1110494658','1045721387','52479459','19473199','53007499','1030580311','1015435254','1010176229','1057185438','70750806',
'1014228597','1031154728','79524588') and hopfchobl ='2019-12-31 00:00:00' and  (hoptotcre - hoptotdeb) > 0 ;

--   Casos 2020

select *  from hosvital.hojoblprv
where  EMPCOD='01' AND cntvig>=2019 and -- hopnoobl in ('VACNOPRES 2019') and
prvcod  in ('1023879993') and hopfchobl >='2019-12-31 00:00:00'  and  (hoptotcre - hoptotdeb) > 0  AND HOPCODCON IS NOT  NULL;

DELETE  from hosvital.hojoblprv where  EMPCOD='01' AND cntvig=2020 and  hopnoobl in ('VACNOPRES 2019') and prvcod  in ('1023879993') and hopfchobl >='2019-12-31 00:00:00'  and  (hoptotcre - hoptotdeb) = 0  AND HOPCODCON IS  NOT NULL;



select *  from hosvital.hojoblprv
where  cntvig>=2019 and  hopnoobl in ('CES.2019','INT.CES2019','VAC2019','VACNOPRES 2019') and
prvcod  in ('1023879993') and hopfchobl >='2019-12-31 00:00:00' ; --  and  (hoptotcre - hoptotdeb) > 0 ;


select * from hosvital.hojoblprv where cntvig>=2019 and  hopnoobl in ('GLOSA 2019') ;  -- and hopfchobl ='2019-12-31 00:00:00' ;


insert into hosvital.hojoblprv (
EMPCOD,PRVCOD,HOPNOOBL,MCDPTO,CNTVIG,CNTCOD,CNUCOD,CNUSUB,CNCCOD,CNTSUB,HOPFCHOBL,HOPFCHRAD,HOPTPPZ,HOPVLRCUO,HOPCUOINI,HOPVLROBL,HOPVLRMEX,HOPTOTCRE,HOPTOTDEB,
HOPMVTER,HOJFCHCAN,HOPESTAFPT,HOJNROOC,HOJBASDES,HOJDOCOC,HOPSEDCAU,HOPDOCCAU,HOPNROCAU,HOPHOM,HOJSEDOC,HOPCODCON, HOPCODCOR)
select EMPCOD,PRVCOD,HOPNOOBL,MCDPTO,2020,CNTCOD,CNUCOD,CNUSUB,CNCCOD,CNTSUB,HOPFCHOBL,HOPFCHRAD,HOPTPPZ,HOPVLRCUO,HOPCUOINI,HOPVLROBL,HOPVLRMEX,HOPTOTCRE,HOPTOTDEB,
HOPMVTER,HOJFCHCAN,HOPESTAFPT,HOJNROOC,HOJBASDES,HOJDOCOC,HOPSEDCAU,HOPDOCCAU,HOPNROCAU,HOPHOM,HOJSEDOC,HOPCODCON, HOPCODCOR
from hosvital.hojoblprv
where  cntvig=2019 and prvcod  in ('1023879993') and  hopnoobl in ('VAC2019','VACNOPRES 2019') and  hopfchobl ='2019-12-31 00:00:00'  and  (hoptotcre - hoptotdeb) > 0  ;



-- Casos 2020

insert into hosvital.hojoblprv (
EMPCOD,PRVCOD,HOPNOOBL,MCDPTO,CNTVIG,CNTCOD,CNUCOD,CNUSUB,CNCCOD,CNTSUB,HOPFCHOBL,HOPFCHRAD,HOPTPPZ,HOPVLRCUO,HOPCUOINI,HOPVLROBL,HOPVLRMEX,HOPTOTCRE,HOPTOTDEB,
HOPMVTER,HOJFCHCAN,HOPESTAFPT,HOJNROOC,HOJBASDES,HOJDOCOC,HOPSEDCAU,HOPDOCCAU,HOPNROCAU,HOPHOM,HOJSEDOC)
select EMPCOD,PRVCOD,HOPNOOBL,MCDPTO,2020,CNTCOD,CNUCOD,CNUSUB,CNCCOD,CNTSUB,HOPFCHOBL,HOPFCHRAD,HOPTPPZ,HOPVLRCUO,HOPCUOINI,HOPVLROBL,HOPVLRMEX,HOPTOTCRE,HOPTOTDEB,
HOPMVTER,HOJFCHCAN,HOPESTAFPT,HOJNROOC,HOJBASDES,HOJDOCOC,HOPSEDCAU,HOPDOCCAU,HOPNROCAU,HOPHOM,HOJSEDOC
from hosvital.hojoblprv
where  cntvig=2019 and  hopnoobl in ('GLOSA 2019') and  hopfchobl ='2019-12-31 00:00:00'  and  (hoptotcre - hoptotdeb) > 0 and (prvcod,hopnoobl) not in (select    prvcod,hopnoobl from hosvital.hojoblprv p1 where  p1.prvcod= prvcod and p1.hopnoobl = hopnoobl and p1.cntvig=2020) ;



select h.hopnoobl, sum(hoptotcre), sum(hoptotdeb), sum(hoptotcre - hoptotdeb)
from hosvital.hojoblprv h
where h.cntvig=2020 and h.hopnoobl in ('GLOSA 2019','CES.2019','INT.CES2019','VAC2019')  and  h.hopfchobl ='2019-12-31 00:00:00'
group by h.hopnoobl;



insert into hosvital.hojoblprv (
EMPCOD,PRVCOD,HOPNOOBL,MCDPTO,CNTVIG,CNTCOD,CNUCOD,CNUSUB,CNCCOD,CNTSUB,HOPFCHOBL,HOPFCHRAD,HOPTPPZ,HOPVLRCUO,HOPCUOINI,HOPVLROBL,HOPVLRMEX,HOPTOTCRE,HOPTOTDEB,
HOPMVTER,HOJFCHCAN,HOPESTAFPT,HOJNROOC,HOJBASDES,HOJDOCOC,HOPSEDCAU,HOPDOCCAU,HOPNROCAU,HOPHOM,HOJSEDOC)
select EMPCOD,PRVCOD,HOPNOOBL,MCDPTO,2020,CNTCOD,CNUCOD,CNUSUB,CNCCOD,CNTSUB,HOPFCHOBL,HOPFCHRAD,HOPTPPZ,HOPVLRCUO,HOPCUOINI,HOPVLROBL,HOPVLRMEX,HOPTOTCRE,HOPTOTDEB,
HOPMVTER,HOJFCHCAN,HOPESTAFPT,HOJNROOC,HOJBASDES,HOJDOCOC,HOPSEDCAU,HOPDOCCAU,HOPNROCAU,HOPHOM,HOJSEDOC
from hosvital.hojoblprv
where  cntvig=2019 and prvcod  in ('80798392') and  hopnoobl in ('VACNOPRES 2019') and  hopfchobl ='2019-12-31 00:00:00'  and  (hoptotcre - hoptotdeb) > 0  ;

-- ConfirmO
SELECT  PRVCOD,CNTVIG,HOPVLROBL
from hosvital.hojoblprv
where  cntvig>=2019 and prvcod  in ('80798392') and  hopnoobl in ('VACNOPRES 2019') and  hopfchobl ='2019-12-31 00:00:00'  and  (hoptotcre - hoptotdeb) > 0  ;